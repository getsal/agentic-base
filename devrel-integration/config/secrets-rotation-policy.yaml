# Secrets Rotation Policy Configuration
# Implements CRITICAL-008: Secrets Rotation Strategy
#
# This configuration defines mandatory rotation intervals for all secrets
# used by the DevRel integration. Regular rotation prevents long-term exposure
# if secrets are leaked.

secrets_rotation:
  # Google Service Account Key
  # Used for Google Drive API access (reading docs, fetching content)
  google_service_account:
    interval_days: 90
    last_rotated: null  # Update after first rotation (YYYY-MM-DD)
    next_rotation: null  # Calculated automatically
    description: "Google Cloud service account key for Drive API"
    rotation_runbook: "docs/runbooks/secrets-rotation.md#google-service-account"

  # Discord Bot Token
  # Used for bot authentication and reading/posting messages
  discord_bot_token:
    interval_days: 90
    last_rotated: null  # Update after first rotation (YYYY-MM-DD)
    next_rotation: null  # Calculated automatically
    description: "Discord bot authentication token"
    rotation_runbook: "docs/runbooks/secrets-rotation.md#discord-bot-token"

  # Anthropic API Key
  # Used for Claude API calls (summarization, translation)
  anthropic_api_key:
    interval_days: 180  # Longer interval for API keys
    last_rotated: null  # Update after first rotation (YYYY-MM-DD)
    next_rotation: null  # Calculated automatically
    description: "Anthropic Claude API key"
    rotation_runbook: "docs/runbooks/secrets-rotation.md#anthropic-api-key"

  # Mirror API Key (if blog publishing enabled)
  # Used for publishing blog posts to Mirror.xyz
  mirror_api_key:
    interval_days: 90
    last_rotated: null  # Update after first rotation (YYYY-MM-DD)
    next_rotation: null  # Calculated automatically
    description: "Mirror.xyz API key for blog publishing"
    rotation_runbook: "docs/runbooks/secrets-rotation.md#mirror-api-key"

  # Linear API Key (if Linear integration enabled)
  # Used for creating/updating Linear issues
  linear_api_key:
    interval_days: 90
    last_rotated: null  # Update after first rotation (YYYY-MM-DD)
    next_rotation: null  # Calculated automatically
    description: "Linear API key for issue tracking"
    rotation_runbook: "docs/runbooks/secrets-rotation.md#linear-api-key"

# Rotation reminder configuration
reminders:
  # Alert this many days before secret expiry
  reminder_days_before: 14

  # Where to send reminders
  notification_channels:
    - "discord"  # Post to #security channel
    - "email"    # Email security team
    - "console"  # Log to console

  # Who receives rotation reminders
  notification_recipients:
    - "security-team@company.com"
    - "devops-team@company.com"
    - "cto@company.com"

# Leak detection configuration
leak_detection:
  # Enable automated leak scanning
  enabled: true

  # Scan frequency
  scan_interval_hours: 168  # Weekly (7 days * 24 hours)

  # Repositories to scan
  repositories:
    - "https://github.com/yourusername/agentic-base"
    # Add more repositories as needed

  # How far back to scan commits (days)
  scan_history_days: 90

  # Pause service immediately if leak detected
  auto_pause_on_leak: true

# Emergency rotation configuration
emergency_rotation:
  # If true, require immediate rotation when secret is compromised
  immediate_rotation_required: true

  # Pause all services until rotation complete
  pause_services_on_compromise: true

  # Notification escalation
  escalate_to:
    - "cto@company.com"
    - "security-lead@company.com"

# Audit trail
audit:
  # Log all rotation events
  log_rotations: true

  # Log file location
  log_file: "logs/secrets-rotation.log"

  # Retention period for audit logs (days)
  retention_days: 365

# SETUP INSTRUCTIONS
# ==================
#
# 1. Initial Setup:
#    - After rotating a secret, update the 'last_rotated' date
#    - Format: YYYY-MM-DD (e.g., "2025-12-08")
#    - next_rotation will be calculated automatically
#
# 2. Rotation Reminders:
#    - The system checks rotation status daily
#    - Alerts sent 14 days before expiry
#    - Critical alerts sent if secret expired
#
# 3. Email Configuration:
#    - Update notification_recipients with real email addresses
#    - Configure SMTP settings in main config
#
# 4. Repository Configuration:
#    - Update repositories list with your GitHub repos
#    - Ensure GitHub token has repo read access
#
# EXAMPLE ROTATION WORKFLOW
# ==========================
#
# Day 0: Secret rotated
#   - Update last_rotated: "2025-12-08"
#   - next_rotation auto-calculated: "2026-03-08" (90 days)
#
# Day 76: Reminder sent (14 days before expiry)
#   - Email sent to security team
#   - Discord notification posted
#
# Day 90: Secret expires
#   - Critical alert sent
#   - Service paused if auto_pause enabled
#
# Day 91+: Overdue
#   - Daily critical alerts
#   - Service remains paused
#
# SECURITY NOTES
# ==============
#
# - NEVER commit this file with actual last_rotated dates to public repos
# - Keep rotation intervals short (90 days recommended)
# - Test rotation procedures regularly
# - Document all rotations in audit log
# - Monitor for unauthorized access during rotation
# - Rotate immediately if compromise suspected
#
# TROUBLESHOOTING
# ===============
#
# Issue: Rotation reminders not being sent
# Fix: Check notification_channels configuration and SMTP settings
#
# Issue: Leak detection not running
# Fix: Verify leak_detection.enabled is true and GitHub token is valid
#
# Issue: next_rotation not calculating
# Fix: Ensure last_rotated is in YYYY-MM-DD format
